<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Electric Field Visualizer</title>

    <style>
        body,
        canvas {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
    </style>

</head>

<body>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.0/p5.js"></script>
<script>

    var v = {
        add: (a, b) => a.map((x, i) => x + b[i]),
        sub: (a, b) => a.map((x, i) => x - b[i]),
        mul: (a, f) => a.map(x => x * f),

        lensq: (a) => a.map(x => x * x).reduce((a, b) => a + b, 0),
        len: (a) => Math.sqrt(v.lensq(a)),

        norm: (a, x) => v.mul(a, (x ? x : 1) / v.len(a))
    }


    function Elect_Single(x, y, e) {
        this.cord = [x, y];
        this.e = e;
        this.field = function (cord) {
            var d = v.sub(cord, this.cord);
            var rr = v.lensq(d);
            var e = this.e / rr;
            var r = Math.sqrt(rr);
            return v.mul(d, e / r);
        }
        this.draw = function () {
            ellipse(...this.cord, 10, 10);
            text(this.e, ...v.add(this.cord, [10, 10]))
        }
    }

    function Elect_Group() {
        this.elects = [];
        this.add = function (elect) {
            this.elects.push(elect);
        }
        this.field = function (cord) {
            var e = [0, 0];
            this.elects.map(x => {
                e = v.add(e, x.field(cord));
            })
            return e;
        }
        this.draw = function () {
            this.elects.map(x => x.draw())
        }
    }

    var elects = new Elect_Group();
    elects.add(new Elect_Single(200, 200, 1));
    elects.add(new Elect_Single(200, 500, -1));
    elects.add(new Elect_Single(500, 200, 1));
    elects.add(new Elect_Single(500, 500, -1));


    var canvas;
    function setup() {
        canvas = createCanvas(window.innerWidth, window.innerHeight);
        window.onresize = function () {
            canvas.resize(window.innerWidth, window.innerHeight);
        }
    }



    function draw() {
        background(255);
        elects.draw();

        var mcord;
        var next = [mouseX, mouseY];

        var f = elects.field(next);
        text(`Ex: ${f[0].toExponential(3)}\nEy: ${f[1].toExponential(3)}`, ...v.add(next, [20, 10]))


        for (var t = 0; t < 100; t++) {
            mcord = next;
            var field = elects.field(mcord);
            field = v.norm(field, 2);

            next = v.add(mcord, field);
            line(...mcord, ...next);
        }

        var dir = v.norm(v.sub(next, mcord), 10);

        var vert = [dir[1], -dir[0]];
        line(...next, ...v.sub(v.add(next, vert), dir))
        line(...next, ...v.sub(v.sub(next, vert), dir))

        next = [mouseX, mouseY];

        for (var t = 0; t < 10; t++) {
            mcord = next;
            var field = elects.field(mcord);
            field = v.norm(field, 2);

            next = v.sub(mcord, field);
            line(...mcord, ...next);
        }

    }




</script>

</html>